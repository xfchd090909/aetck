<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Anosu 图片代理调用工具</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 1200px; margin: 0 auto; }
    .params { background: #f5f5f5; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
    .param-group { margin-bottom: 15px; }
    label { display: inline-block; width: 100px; font-weight: bold; }
    input, select { padding: 8px; width: 200px; border: 1px solid #ddd; border-radius: 4px; }
    button { padding: 10px 20px; background: #007cf0; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #005fc4; }
    .image-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; }
    .image-item { border: 1px solid #eee; border-radius: 8px; overflow: hidden; }
    .image-item img { width: 100%; height: 250px; object-fit: cover; }
    .error { color: #e53935; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Anosu 图片代理调用工具</h1>

  <!-- 参数配置区域 -->
  <div class="params">
    <div class="param-group">
      <label for="num">图片数量：</label>
      <input type="number" id="num" min="1" max="30" value="5" placeholder="1-30">
    </div>
    <div class="param-group">
      <label for="r18">年龄分级：</label>
      <select id="r18">
        <option value="0">全年龄</option>
        <option value="1">18+</option>
        <option value="2">随机</option>
      </select>
    </div>
    <div class="param-group">
      <label for="size">图片尺寸：</label>
      <select id="size">
        <option value="original">原图</option>
        <option value="regular">详情页缩略图</option>
        <option value="small">首页缩略图</option>
      </select>
    </div>
    <div class="param-group">
      <label for="keyword">关键词：</label>
      <input type="text" id="keyword" placeholder="多关键词用 | 分隔（如 genshin|barefoot）">
    </div>
    <div class="param-group">
      <label for="db">图库选择：</label>
      <select id="db">
        <option value="0">新图库（2.5w张，精选）</option>
        <option value="1">旧图库（4w张，质量参差不齐）</option>
      </select>
    </div>
    <button onclick="fetchImages()">获取图片</button>
    <div id="error" class="error"></div>
  </div>

  <!-- 图片展示区域 -->
  <div class="image-container" id="imageContainer"></div>

  <script>
    // 1. 配置你的 Workers 代理地址（替换为你的域名）
    const WORKER_PROXY = 'https://aenews.dpdns.org/proxy/';
    // 2. Anosu 接口地址（固定）
    const ANOSU_API = 'https://image.anosu.top/pixiv/direct';

    /**
     * 调用 Anosu 接口并展示图片
     */
    async function fetchImages() {
      // 清空之前的图片和错误提示
      const imageContainer = document.getElementById('imageContainer');
      const errorEl = document.getElementById('error');
      imageContainer.innerHTML = '';
      errorEl.textContent = '';

      // 获取用户输入的参数
      const params = new URLSearchParams({
        num: document.getElementById('num').value,
        r18: document.getElementById('r18').value,
        size: document.getElementById('size').value,
        keyword: document.getElementById('keyword').value || '',
        db: document.getElementById('db').value,
        proxy: WORKER_PROXY.replace('https://', '').replace(/\/$/, '') // Anosu 的 proxy 参数不需要协议和末尾 /
      });

      try {
        // 调用 Anosu 接口
        const response = await fetch(`${ANOSU_API}?${params.toString()}`, {
          method: 'GET',
          headers: { 'Accept': 'application/json' }
        });

        if (!response.ok) throw new Error(`接口请求失败：${response.status}`);
        const data = await response.json();

        // 处理返回结果（Anosu 成功时返回图片URL数组）
        if (!Array.isArray(data) || data.length === 0) {
          errorEl.textContent = '未获取到图片，请检查参数（如 num 范围1-30）';
          return;
        }

        // 渲染图片到页面
        data.forEach(imgUrl => {
          const imgItem = document.createElement('div');
          imgItem.className = 'image-item';
          // 使用 Workers 代理地址替换图片的原代理
          const proxyImgUrl = imgUrl.replace(/^https?:\/\/[^\/]+\/?/, WORKER_PROXY);
          imgItem.innerHTML = `<img src="${proxyImgUrl}" alt="Anosu 图片" loading="lazy">`;
          imageContainer.appendChild(imgItem);
        });
      } catch (err) {
        errorEl.textContent = `错误：${err.message}`;
      }
    }
  </script>
</body>
</html>
